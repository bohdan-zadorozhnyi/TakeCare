{% extends "base.html" %}

{% block title %}
    Create new appointment slots
{% endblock %}

{% block extra_css %}
<style>

    .btn-primary, .btn-danger {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-danger {
        background-color: #dc3545;
        color: white;
    }

    .btn:hover {
        opacity: 0.9;
    }

    /* Modal layout */
    .modal-content {
        padding: 30px;
        background: #fff;
        border-radius: 12px;
        width: 90%;
        max-width: 850px;
        margin: 40px auto;
        box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-row > div {
        flex: 1;
        min-width: 200px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    /* Inputs, select, textarea */
    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="number"],
    select,
    textarea {
        width: 100%;
        padding: 10px 12px;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 6px;
        box-sizing: border-box;
        transition: border-color 0.3s;
    }

    input:focus,
    select:focus,
    textarea:focus {
        outline: none;
        border-color: #007bff;
    }

    textarea {
        resize: vertical;
        min-height: 100px;
    }

    /* Checkbox & Radio styling */
    .checkbox-container,
    .radio-container {
        margin-bottom: 10px;
    }

    .radio-container label {
        margin-right: 20px;
    }

    .radio-container input {
        margin-right: 6px;
    }
</style>
{% endblock %}
{% block content %}

    <div class="modal-content">
        <h2>Create New Appointment Slot</h2>
        <form id="appointmentForm" method="post" action="{% url 'appointments:create_appointment' %}" style="margin-top: 10px;">
            {% csrf_token %}

            <!-- Date, Time, Duration -->
            <div class="form-row">
                <div>
                    <label for="appointmentDate">Date:</label>
                    <input type="date" id="appointmentDate" name="date" required>
                </div>
                <div>
                    <label for="appointmentTime">Time:</label>
                    <input type="time" id="appointmentTime" name="time" required>
                </div>
                <div>
                    <label for="appointmentDuration">Duration:</label>
                    <select id="appointmentDuration" name="duration" required>
                        <option value="15">15 minutes</option>
                        <option value="30" selected>30 minutes</option>
                        <option value="45">45 minutes</option>
                        <option value="60">1 hour</option>
                        <option value="90">1 hour 30 minutes</option>
                        <option value="120">2 hours</option>
                    </select>
                </div>
            </div>

            <!-- Location -->
            <div class="form-group">
                <label for="appointmentLocation">Location:</label>
                <input type="text" id="appointmentLocation" name="location" list="locations" placeholder="Enter location">
                <datalist id="locations">
                    {% for location in doctor_locations %}
                        <option value="{{ location }}">{{ location }}</option>
                    {% endfor %}
                </datalist>
            </div>

            <!-- Patient Selection -->
            <div class="form-group">
                <label for="appointmentPatient">Patient (optional):</label>
                <select id="appointmentPatient" name="patient">
                    <option value="">No specific patient</option>
                    {% for patient in patients %}
                        <option value="{{ patient.id }}">{{ patient.get_full_name|default:patient.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <!-- Referral Type -->
            <div class="form-group">
                <label for="referal_type">Referral Type (if required):</label>
                <select id="referal_type" name="referal_type">
                    <option value="">No referral required</option>
                    <option value="CARDIOLOGIST">Cardiologist</option>
                    <option value="DERMATOLOGIST">Dermatologist</option>
                    <option value="NEUROLOGIST">Neurologist</option>
                    <option value="ORTHOPEDIST">Orthopedist</option>
                    <option value="PEDIATRICIAN">Pediatrician</option>
                    <option value="PSYCHIATRIST">Psychiatrist</option>
                </select>
            </div>

            <!-- Recurring Appointment -->
            <div class="form-group">
                <label class="checkbox-container" style="display: flex; flex-direction: row; flex-grow: 1; justify-content: space-between;">
                    Make this a recurring appointment
                    <input type="checkbox" id="isRecurring" name="is_recurring">
                </label>
                <div id="recurringOptions" style="display: none;">
                    <select class="radio-container" name="recurring_type">
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="biweekly">Every two weeks</option>
                        <option value="monthly">Monthly</option>
                    </select>
                    <div class="form-group">
                        <label for="recurringCount">Number of occurrences:</label>
                        <input type="number" id="recurringCount" name="recurring_count" min="2" max="52" value="4">
                    </div>
                </div>
            </div>

            <!-- Description -->
            <div class="form-group">
                <label for="appointmentDescription">Description:</label>
                <textarea id="appointmentDescription" name="description" rows="3"></textarea>
            </div>

            <!-- Buttons -->
            <div style="margin-top: 30px; display: flex; justify-content: center; gap: 20px;">
                <button type="submit" class="btn btn-primary">Create Appointment</button>
                <a href="{% url 'appointments:appointment_list' %}" class="btn btn-danger" id="cancelBtn">Cancel</a>
            </div>
        </form>
    </div>

{% endblock %}

{% block extra_js %} 
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Set today's date as minimum
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('appointmentDate').min = today;
    
        // Toggle recurring options
        const isRecurringCheckbox = document.getElementById('isRecurring');
        const recurringOptions = document.getElementById('recurringOptions');
    
        isRecurringCheckbox.onchange = function () {
            recurringOptions.style.display = this.checked ? 'block' : 'none';
        };
    
        // Handle form submission
        document.getElementById('appointmentForm').onsubmit = function(e) {
            e.preventDefault();
            
            const date = document.getElementById('appointmentDate').value;
            const time = document.getElementById('appointmentTime').value;
    
            if (date && time) {
                const datetime = date + 'T' + time;
                const datetimeInput = document.createElement('input');
                datetimeInput.type = 'hidden';
                datetimeInput.name = 'datetime';
                datetimeInput.value = datetime;
                this.appendChild(datetimeInput);
                
                // Submit the form
                this.submit();
            }
        };
    });
</script>
{% endblock %}