{% extends 'chat/chatroom_list.html' %}
{% load static %}

{% block content %}
<div class="chat-layout">
    {{ block.super }}
</div>

{% if chatroom %}
<script>
    // Chat main content template
    const mainContent = `
        <div class="chat-header">
            <div class="chat-header-content">
                <h1>{{ other_participant_name }}</h1>
                <div class="participants">Conversation with {{ other_participant_name }}</div>
            </div>
            <a href="{% url 'chatroom_list' %}" class="all-chats-btn">
                <i class="fas fa-arrow-left"></i> Back to chats
            </a>
        </div>

        <div id="messages" class="messages-container">
            {% for message in messages %}
            <div class="message {% if message.sender == request.user %}sent{% else %}received{% endif %}">
                <div class="message-content">
                    <p>{{ message.content }}</p>
                    <span class="timestamp">{{ message.timestamp|date:"H:i" }}</span>
                </div>
            </div>
            {% endfor %}
        </div>

        <div id="error-message" class="error-message">
            <div class="error-title"></div>
            <div class="error-content"></div>
            <div class="error-details"></div>
        </div>

        <div class="message-input">
            <form id="message-form">
                <textarea id="message-content" placeholder="Type your message..."></textarea>
                <button type="submit" class="btn btn-primary">Send</button>
            </form>
        </div>
    `;

    // Set the main content
    document.querySelector('.chat-main').innerHTML = mainContent;

    // Initialize chat functionality
    document.addEventListener('DOMContentLoaded', function() {
        initializeChatDetail('{{ chatroom.id }}', '{{ request.user.id }}');
    });
</script>
{% endif %}
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="{% static 'js/chat/chat-detail.js' %}"></script>
{% endblock %}