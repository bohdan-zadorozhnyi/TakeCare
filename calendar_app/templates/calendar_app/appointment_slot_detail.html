{% extends 'base.html' %}
{% load static %}

{% block title %}Appointment Slot Details{% endblock %}

{% block extra_css %}
<style>
    .slot-container {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        padding: 20px;
        margin-bottom: 20px;
    }
    
    .slot-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }
    
    .slot-title {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 0;
        color: #333;
    }
    
    .slot-subtitle {
        margin-top: 5px;
        color: #666;
    }
    
    .slot-actions {
        display: flex;
        gap: 10px;
    }
    
    .slot-info {
        margin-bottom: 30px;
    }
    
    .slot-detail {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .slot-detail i {
        width: 20px;
        margin-right: 10px;
        color: #007bff;
    }
    
    .slot-detail-label {
        font-weight: 600;
        margin-right: 10px;
        min-width: 100px;
    }
    
    .slot-form {
        background: #f9f9f9;
        border-radius: 8px;
        padding: 20px;
        margin-top: 20px;
    }
    
    .form-group {
        margin-bottom: 15px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
    }
    
    .form-control {
        width: 100%;
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ddd;
    }
    
    @media (max-width: 768px) {
        .slot-actions {
            margin-top: 15px;
        }
        
        .slot-detail {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .slot-detail i {
            margin-bottom: 5px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="slot-container">
    <div class="slot-header">
        <div>
            <h1 class="slot-title">
                Appointment Slot: {{ slot.date|date:"l, F j, Y â€¢ g:i A" }}
            </h1>
            <p class="slot-subtitle">Status: <span class="badge {% if slot.status == 'Booked' %}bg-primary{% elif slot.status == 'Available' %}bg-success{% else %}bg-warning{% endif %}">{{ slot.status }}</span></p>
        </div>
        
        <div class="slot-actions">
            <a href="{% url 'calendar_view' %}" class="btn btn-outline-primary">
                <i class="fas fa-calendar"></i> Back to Calendar
            </a>
            
            {% if can_edit %}
            {% comment %} <a href="#edit-form" class="btn btn-secondary">
                <i class="fas fa-edit"></i> Edit Slot
            </a> {% endcomment %}
            
            <form action="{% url 'cancel_appointment' slot.id %}" method="post" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this slot?')">
                    <i class="fas fa-trash"></i> Delete Slot
                </button>
            </form>
            {% endif %}
        </div>
    </div>
    
    <div class="slot-info">
        <div class="slot-detail">
            <i class="fas fa-clock"></i>
            <span class="slot-detail-label">Time:</span>
            <span>{{ slot.date|date:"g:i A" }} - {{ end_time }}</span>
        </div>
        
        <div class="slot-detail">
            <i class="fas fa-hourglass-half"></i>
            <span class="slot-detail-label">Duration:</span>
            <span>{{ slot.duration }} minutes</span>
        </div>
        
        <div class="slot-detail">
            <i class="fas fa-map-marker-alt"></i>
            <span class="slot-detail-label">Location:</span>
            <span>{{ slot.location }}</span>
        </div>
        
        <div class="slot-detail">
            <i class="fas fa-stethoscope"></i>
            <span class="slot-detail-label">Service Type:</span>
            <span>{{ slot.referal_type|default:"General Consultation" }}</span>
        </div>
        
        <div class="slot-detail">
            <i class="fas fa-info-circle"></i>
            <span class="slot-detail-label">Description:</span>
            <span>{{ slot.description }}</span>
        </div>
    </div>
    
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Template filter to add minutes to a time
    function addMinutes(timeStr, minutes) {
        const [hour, minutePart] = timeStr.split(':');
        const [minute, period] = minutePart.split(' ');
        
        let totalMinutes = parseInt(hour) * 60 + parseInt(minute) + parseInt(minutes);
        
        let newHour = Math.floor(totalMinutes / 60);
        let newMinute = totalMinutes % 60;
        
        // Handle 12-hour format
        let newPeriod = period;
        if (newHour >= 12) {
            if (newHour > 12) newHour -= 12;
            newPeriod = 'PM';
        } else if (newHour === 0) {
            newHour = 12;
            newPeriod = 'AM';
        }
        
        return `${newHour}:${newMinute.toString().padStart(2, '0')} ${newPeriod}`;
    }
</script>
{% endblock %}